<div id={@id}>
  <%= if @open == true do %>
    <div
      class="bottom-0 fixed flex h-screen inset-x-0 overflow-y-auto z-50"
      id={"kamansky-modal-#{@id}"}
      phx-hook="modalInit"
      phx-target={"##{@id}"}
      x-data="{buttonText: null, open: false, title: null}"
      x-init={
        "() => {
          $nextTick(() => open = true);
          $watch('open', isOpen => $dispatch('kamansky:toggle-modal', { open: isOpen, id: '##{@id}' }));
        }"
      }
      x-on:phx:kamansky:close-modal.camel.window="open = false"
      x-show="open"
    >
      <div
        class="fixed inset-0 transition-opacity"
        x-show="open"
        x-transition:enter="ease-out duration-300"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100"
        x-transition:leave="ease-in duration-200"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
      >
        <div class="absolute bg-gray-900 inset-0 opacity-50"></div>
      </div>
      <div
        class="max-w-3xl m-auto px-4 shadow-lg sm:px-0 w-full"
        x-show="open"
        x-transition:enter="ease-out duration-300"
        x-transition:enter-start="opacity-0 sm:scale-95"
        x-transition:enter-end="opacity-100 sm:scale-100"
        x-transition:leave="ease-in duration-200"
        x-transition:leave-start="opacity-100 sm:scale-100"
        x-transition:leave-end="opacity-0 sm:scale-95"
      >
        <div 
          class="bg-white border border-gray-200 flex flex-col relative rounded-lg"
          x-on:click.away="open = false" 
          x-on:keydown.escape.window="open = false" 
        >
          <div class="flex items-center justify-between p-4 rounded-t">
            <h3 class="text-lg leading-6 font-medium text-gray-900" x-text="title" />
              <button
                class="
                  text-gray-400 
                  focus:outline-none 
                  focus:text-gray-500
                  hover:text-gray-500"
                type="button" 
                x-on:click="open = false"   
              >
                &times;
              </button>
          </div>
          <div class="flex-auto p-4 relative w-full">
            <.live_component module={@component} {@opts} />
          </div>
          <%= unless @opts[:footer] == false do %>
            <div class="border border-gray-200 flex flex-row-reverse justify-start rounded-b p-3">
              <button
                type="submit"
                class="btn btn-blue ml-1"
                form={Keyword.get(@opts, :form_id)}
                phx-click={Keyword.get(@opts, :button_action)}
              >
                <div class="kamansky-button-loading">
                  <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                  </svg>
                  Processing
                </div>
                <span class="kamansky-button-normal" x-text="buttonText ? buttonText : title" />
              </button>
              <button 
                class="btn btn-gray"
                type="button"
                x-on:click="open = false"
              >Cancel</button>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>
</div>